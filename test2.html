<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>POIs mit Suche & Filter</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-omnivore/leaflet-omnivore.min.js"></script>
  <style>
    body { margin:0; display:flex; height:100vh; font-family: sans-serif; }
    #sidebar {
      width: 300px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #ccc;
    }
    #search {
      padding: 8px;
      border: none;
      border-bottom: 1px solid #ccc;
      outline: none;
      font-size: 14px;
    }
    #poi-list {
      flex: 1;
      overflow-y: auto;
    }
    .poi-item {
      padding: 6px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }
    .poi-item:hover {
      background: #f0f0f0;
    }
    #map { flex: 1; }
  </style>
</head>
<body>
  <div id="sidebar">
    <input type="text" id="search" placeholder="ðŸ” POI suchen...">
    <div id="poi-list"></div>
  </div>
  <div id="map"></div>
  
  <script>
    const map = L.map('map').setView([51.1657, 10.4515], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    const poiListDiv = document.getElementById("poi-list");
    const searchInput = document.getElementById("search");
    const allPOIs = [];

    // KML laden
    omnivore.kml('https://www.google.com/maps/d/u/0/kml?mid=DEINE_MAP_ID&forcekml=1')
      .on('ready', function(e) {
        map.fitBounds(e.target.getBounds());

        e.target.eachLayer(layer => {
          if (layer.feature && layer.feature.properties && layer.feature.properties.name) {
            const name = layer.feature.properties.name;
            const desc = layer.feature.properties.description || "";

            // Popup
            layer.bindPopup(`<b>${name}</b><br>${desc}`);

            // POI speichern
            allPOIs.push({
              name,
              desc,
              layer
            });
          }
        });

        renderList(allPOIs);
      })
      .addTo(map);

    // Liste rendern
    function renderList(pois) {
      poiListDiv.innerHTML = "";
      pois.forEach(poi => {
        const item = document.createElement("div");
        item.className = "poi-item";
        item.textContent = poi.name;
        item.onclick = () => {
          map.setView(poi.layer.getLatLng(), 15);
          poi.layer.openPopup();
        };
        poiListDiv.appendChild(item);
      });

      // Karte updaten: erst alle POIs rausnehmen
      allPOIs.forEach(poi => {
        map.removeLayer(poi.layer);
      });

      // dann nur gefilterte wieder hinzufÃ¼gen
      pois.forEach(poi => {
        poi.layer.addTo(map);
      });

      // Zoom anpassen, falls Treffer vorhanden
      if (pois.length > 0) {
        const group = L.featureGroup(pois.map(p => p.layer));
        map.fitBounds(group.getBounds());
      }
    }

    // Suche/Filter
    searchInput.addEventListener("input", () => {
      const searchTerm = searchInput.value.toLowerCase();
      const filtered = allPOIs.filter(poi =>
        poi.name.toLowerCase().includes(searchTerm) ||
        poi.desc.toLowerCase().includes(searchTerm)
      );
      renderList(filtered);
    });
  </script>
</body>
</html>
